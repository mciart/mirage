# ========== 服务器 ==========
[server]
# 服务器地址 (域名或 IP)
host = "mirage"
# 服务器端口 (默认: 443)
port = 443

# ========== 静态 IP 配置 (可选) ==========
# 请求服务器分配指定的内网 IP，如果已被占用，连接将被拒绝
# static_client_ip = "10.11.12.13"
# static_client_ip_v6 = "fd00::fd00"

# ========== 认证 ==========
[authentication]
# 认证使用的用户名
username = "test"
# 认证使用的密码
password = "test"
# 信任的证书文件路径列表（服务器证书或自签名 CA）
# trusted_certificate_paths = ["examples/cert/server_cert.pem"]
# 信任的 PEM 格式证书字符串列表（可选）
# trusted_certificates = [
#     "-----BEGIN CERTIFICATE-----\n..."
# ]

# ========== 传输层 ==========
[transport]
# 传输协议优先级列表: "tcp" (TCP+TLS) 和/或 "udp" (QUIC)
# 按顺序尝试，第一个协议优先，失败后回退到下一个
# 例如 ["udp", "tcp"] 表示优先使用 QUIC，失败后回退到 TCP+TLS
protocols = ["udp", "tcp"]
# 并行连接数 (1-4, 默认: 1)
# 多连接可提高带宽聚合，但占用更多资源
parallel_connections = 1
# IPv4/IPv6 双栈并发聚合 (默认: false)
# 开启后将同时使用 IPv4 和 IPv6 连接，并在它们之间进行负载均衡
dual_stack = false
# 自定义 SNI (Server Name Indication)
# 如果指定，将使用此域名进行 TLS/QUIC 握手，而不是 server.host 中的地址
# 这允许你直接连接到 IP (如 CDN 节点) 但伪装成正确的域名
# sni = "www.example.com"
# 仅供测试：禁用 TLS 证书验证（适用于自签名证书）
# 警告：不安全！
insecure = false
# 开启 TCP NODELAY (默认: true)
tcp_nodelay = true
# 端口跳跃间隔 (秒, 0 = 禁用, 默认: 0)
# 使用 UDP (QUIC) 时，每隔指定秒数自动轮换 UDP 端口
# 可有效对抗 ISP 对长 UDP 连接的阻断 (QoS)
port_hopping_interval_s = 0

# ========== 伪装层 ==========
[camouflage]
# 伪装模式: "none" (标准 TLS) 或 "mirage" (SNI 伪装 + 反主动探测)
mode = "mirage"
# 伪装目标 SNI (必须与 Server 一致)
target_sni = "www.microsoft.com"
# 客户端认证 ShortId (取列表第一个)
short_ids = ["abcd1234deadbeef"]
# JLS 伪装密码 (启用 QUIC/UDP 传输时填写，客户端和服务端必须一致)
# jls_password = "your-jls-password"
# JLS 初始化向量 (启用 QUIC/UDP 传输时填写，客户端和服务端必须一致)
# jls_iv = "your-jls-iv"
# 应用层加密密钥 (与 inner_encryption 配合使用)
# 客户端和服务端必须设置相同的密钥
# inner_key = "your-inner-encryption-key"

# ========== 连接管理 ==========
[connection]
# 隧道和生成的 TUN 接口使用的 MTU
# 默认 1280（IPv6 最小 MTU，减少 TCP-over-TCP 问题）
mtu = 1280
# 外层隧道 MTU (UDP 包大小限制)
# 默认 1420，建议保持此值或根据网络状况微调
# 如果想要启用巨型帧优化(Jumbo Frames)，可以将 mtu 设为 65535，outer_mtu 保持 1420
outer_mtu = 1420
# 连接超时时间（秒）
timeout_s = 30
# 连接失败后的重试间隔（秒）
retry_interval_s = 5
# 心跳保活间隔（秒）
keep_alive_interval_s = 25
# 连接最大生存时间 (秒, 0 = 禁用, 默认: 300)
# 超过此时间的底层连接会被静默替换为新连接
# 可有效对抗防火墙基于长连接时长的代理检测 (如 Geedge Networks)
# VPN 连接不会中断，因为 TUN 接口的 IP 地址不变
max_lifetime_s = 300
# 连接寿命随机抖动 (秒, 默认: 60)
# 防止多条连接同时轮换产生流量特征
lifetime_jitter_s = 60
# 多路复用模式 (默认: "round_robin")
# "round_robin" - 包级别轮询分发到所有连接 (类似 XMUX, 更好的混淆和带宽聚合)
# "active_standby" - 仅使用一条连接, 故障时切换到备用 (旧行为)
mux_mode = "round_robin"

# ========== 流量混淆 ==========
[obfuscation]
# 是否启用流量混淆 (默认: true)
enabled = true
# 发送随机填充包的概率 (0.0-1.0, 默认: 0.15)
# 配合加权拟态轮廓 (Weighted Traffic Mimicry)，触发 60% 小包 / 30% 中包 / 10% 大包的分布
# 同时启用独立填充定时器 (2-8s 随机间隔)，打破填充包仅跟随数据包的可识别模式
padding_probability = 0.15
# 随机填充包的最小长度 (字节, 默认: 40)
padding_min = 40
# 随机填充包的最大长度 (字节, 默认: 1200)
padding_max = 1200
# Jitter (抖动) 延迟范围 (毫秒)
# 自适应模式：空闲时自动放大抖动模拟浏览行为，高流量时自动缩小保障吞吐
# 建议 0-20ms，过大会影响性能
jitter_min_ms = 0
jitter_max_ms = 0
# 将写入缓冲区填充到 TLS Record 边界 (16KB)，使 TLS 记录大小更均匀 (默认: false)
# 启用后带宽开销增加，但可有效对抗 TLS 记录大小指纹识别
# tls_record_padding = false
# 应用层加密 (ChaCha20-Poly1305)，即使外层 TLS 被 CDN 剥离，内层数据仍加密 (默认: false)
# 启用时需在 [camouflage] 中设置 inner_key，客户端和服务端必须一致
# inner_encryption = false

# ========== 网络 ==========
[network]
# 需要通过隧道路由的网段列表 (CIDR 格式)
routes = [
    "10.11.12.0/24",
    "fd00::/64"
]
# 需要排除在隧道之外的网段列表 (走本地网关)
# 当 routes 包含 0.0.0.0/0 (全局路由) 时非常有用，可用于排除内网地址
excluded_routes = [
    "192.168.0.0/16",
    "172.16.0.0/12",
    "10.0.0.0/8"
]
# 指定本地 TUN 网卡名称 (例如 "tun0" 或 "utun3")
# 不填则由系统自动分配
# interface_name = "mirage0"
# 隧道使用的 DNS 服务器
dns_servers = [
    "1.1.1.1",
    "2606:4700:4700::1111"
]

# ========== 日志 ==========
[log]
# 日志级别 (trace, debug, info, warn, error)
level = "info"
